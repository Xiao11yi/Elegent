import{_ as Q,u as ue,A as oe,r as n,D as ee,b as h,k as we,w as d,d as e,f as t,h as m,t as _,i as H,c as f,J as se,K as I,S as de,L as Ce,m as _e,g as ve,Z as Ie,a2 as be,o as pe,F as Z,e as G,n as me,j as ae,v as he,x as fe,z as ye,y as xe,C as $e,a as J,H as te,I as le,V as ie,E as Le,l as ge,s as Ne,a3 as Te,q as Se}from"./index-08731fde.js";/* empty css                   *//* empty css                */import{e as Ve,i as Ee,f as Ue,g as ze,h as Re,j as Be,k as De}from"./article-969d75ae.js";/* empty css                */import{a as Ae,d as qe}from"./concern-90d87c1c.js";/* empty css                 */import{d as Fe,a as Me,b as Oe,c as je,g as He}from"./comment-80f8f8ef.js";import{J as Je}from"./style-a54575cc.js";const Ke=""+new URL("tag-e5e33e2d.svg",import.meta.url).href,Pe=""+new URL("islike-25ead941.svg",import.meta.url).href,Ye=""+new URL("example-ffc5e1b1.svg",import.meta.url).href,Ze=""+new URL("c-3b4d6acb.svg",import.meta.url).href,Ge=""+new URL("d-fda6ae65.svg",import.meta.url).href;const Qe={class:"personal-info-num",style:{margin:"10px 0 0px"}},We={class:"personal-info"},Xe={key:0,class:"personal-btn"},et={__name:"index",setup(b){var l;const E=ue(),y=oe(),w=n(""),o=n({}),i=n("");i.value=(l=E.currentRoute.value.params)==null?void 0:l.id;const a=n(!1),c=ee.get("username"),v=()=>{if(y){let s=JSON.stringify(o.value);E.push({path:"/news/chat",query:{allData:encodeURIComponent(s)}})}else I({type:"error",message:"请先登录"})},C=s=>{Ae({followedId:s,followersId:ee.get("userId")}).then(r=>{r.data?(I({type:"success",message:"关注成功"}),S()):I({type:"error",message:"操作失败"})}).catch(r=>{console.error("Error adding concern:",r)})},z=s=>{qe({followedId:s,followersId:ee.get("userId")}).then(r=>{r.data?(I({type:"success",message:"已取消关注"}),S()):I({type:"error",message:"操作失败"})}).catch(r=>{console.error("Error deleting concern:",r)})},u=n(!1),x=async()=>{const s=await Ve(i.value);o.value=s.data,u.value=s.data.user_name===c,w.value="/dev-api"+s.data.avatar},S=()=>{y&&Ee(i.value).then(s=>{a.value=s.data})};let L="";const N=(s,r)=>{L=E.resolve({path:`/${s}/${r}`}),window.open(L.href,"_blank")};return x(),S(),(s,r)=>{const B=de,V=Ce,D=_e,U=ve;return h(),we(U,{class:"personal-card"},{default:d(()=>[e("div",{class:"demo-image",onClick:r[0]||(r[0]=A=>N("user",o.value.user_id))},[t(B,{size:60,src:w.value},null,8,["src"])]),e("p",{class:"personal-name",onClick:r[1]||(r[1]=A=>N("user",o.value.user_id))},[t(V,null,{default:d(()=>[m(_(o.value.user_name),1)]),_:1})]),e("p",Qe,[t(V,null,{default:d(()=>[m(_(o.value.article_count),1)]),_:1}),t(V,null,{default:d(()=>[m(_(o.value.view_count>1e3?Math.floor(o.value.view_count/1e3)+"K":o.value.view_count),1)]),_:1}),t(V,null,{default:d(()=>[m(_(o.value.follow_count),1)]),_:1})]),e("p",We,[t(V,null,{default:d(()=>[m("文章")]),_:1}),t(V,null,{default:d(()=>[m("浏览")]),_:1}),t(V,null,{default:d(()=>[m("粉丝")]),_:1})]),!u.value&&H(y)?(h(),f("div",Xe,[t(D,{onClick:v},{default:d(()=>[m("私信")]),_:1}),t(D,{type:"primary",onClick:r[2]||(r[2]=A=>a.value?z(o.value.user_id):C(o.value.user_id))},{default:d(()=>[m(_(a.value?"取消关注":"关注"),1)]),_:1})])):se("",!0)]),_:1})}}},tt=Q(et,[["__scopeId","data-v-1bb3a0c2"]]);const lt={setup(){let b=n([]),E=Ie({}),y=n(0);function w(){let a=[],c=["h1","h2","h3","h4","h5"],v=document.querySelector(".post-card .article-content");if(!v)return a;let C=Array.from(v.querySelectorAll("*")),z=new Set(C.map(u=>u.tagName.toLowerCase()));for(let u=c.length-1;u>=0;u--)z.has(c[u])||c.splice(u,1);for(let u=0;u<C.length;u++){const x=C[u];let S=x.tagName.toLowerCase(),L=c.indexOf(S);if(L==-1)continue;let l={id:S+"-"+x.innerText+"-"+u,level:L,parent:null,children:[],rawName:x.innerText,scrollTop:x.offsetTop+160};if(a.length>0){let s=a[a.length-1];if(s.level<l.level)l.parent=s,s.children.push(l);else if(s.level>l.level){let r=s.parent;for(;r;){if(r.level<l.level){r.children.push(l),l.parent=r;break}r=r.parent}}else s.parent&&(l.parent=s.parent,s.parent.children.push(l))}l.isVisible=l.parent==null,l.name=x.innerText,a.push(l)}return a}window.addEventListener("scroll",o);function o(){let a=document.querySelector(".post-card .article-content");const c=parseInt(window.scrollY/(a.scrollHeight-window.innerHeight)*100);y.value=(c<0||c>100?100:c)+"%"}function i(a){window.scrollTo({top:a,behavior:"smooth"})}return be(()=>{window.removeEventListener("scroll",o)}),pe(()=>{const a=document.querySelector(".post-card .article-content"),c=new MutationObserver((C,z)=>{for(let u of C)u.type==="childList"&&u.addedNodes.length>0&&u.addedNodes.forEach(x=>{b.value=w()})}),v={childList:!0,subtree:!0};a&&c.observe(a,v)}),{navsList:b,currentTitle:E,progress:y,scrollToView:i}}},st=b=>(he("data-v-948a8508"),b=b(),fe(),b),at={class:"catalog-card"},ot={class:"catalog-card-header"},nt=st(()=>e("div",null,[e("span",null,"目录")],-1)),ct={class:"progress"},rt={class:"catalog-content"},it=["onClick","title"];function ut(b,E,y,w,o,i){return h(),f("div",at,[e("div",ot,[nt,e("span",ct,_(w.progress),1)]),e("div",rt,[(h(!0),f(Z,null,G(w.navsList,a=>(h(),f("div",{key:a.id,onClick:c=>w.scrollToView(a.scrollTop),class:me(["catalog-item",w.currentTitle.id==a.id?"active":"not-active"]),style:ae({marginLeft:a.level*20+"px"}),title:a.rawName},_(a.name),15,it))),128))])])}const dt=Q(lt,[["render",ut],["__scopeId","data-v-948a8508"]]);const _t={class:"my-reply"},vt={class:"reply-info"},pt={class:"reply-btn-box"},mt={class:"author-info"},ht={class:"author-name"},ft={class:"author-time"},yt={class:"icon-btn"},gt=["onClick"],kt=["onClick"],wt={class:"talk-box"},Ct={class:"reply"},It={class:"my-reply my-comment-reply"},bt={class:"reply-info"},xt={class:"reply-btn-box"},$t={class:"reply-box"},Lt={class:"author-info"},Nt={class:"author-name"},Tt={class:"author-time"},St={class:"icon-btn"},Vt=["onClick"],Et=["onClick"],Ut={class:"talk-box"},zt={class:"reply"},Rt={class:"my-reply my-comment-reply",style:{"margin-left":"0px"}},Bt={class:"reply-info"},Dt={class:"reply-btn-box"},At={__name:"index",setup(b){var ce;const E=ye(),y=n((ce=E.params)==null?void 0:ce.id),w=xe(),o=n(!1),i=n(""),a=n("输入评论..."),c=n(""),v=n(w.state.user.avatar),C=oe(),z=n(""),u=n(-1),x=n(0),S=n([]),L=n(""),N=n({}),l=()=>{o.value=!0},s=n(null),r=p=>{C?Fe({commentId:p,articleId:y.value}).then(g=>{M(),I({type:"success",message:"删除成功"})}):I({type:"error",message:"请先登录"})},B=(p,g)=>{C?Me({id:p,articleId:y.value,toId:g}).then($=>{M(),I({type:"success",message:"删除成功"})}):I({type:"error",message:"请先登录"})},V=p=>U.value===p,D=(p,g)=>{const $=Number(p.toString()+g.toString());return s.value===$},U=n(null),A=(p,g,$,q)=>{C?(U.value===p?U.value=null:(U.value=p,s.value=null),a.value="回复"+g,i.value="",z.value=g,x.value=q,u.value=$):I({type:"error",message:"请先登录"})},W=(p,g,$,q,O)=>{if(C){const j=Number(p.toString()+g.toString());s.value===j?s.value=null:(s.value=j,U.value=null),a.value="回复"+$,x.value=O,i.value="",z.value=$,u.value=q}else I({type:"error",message:"请先登录"})},R=n({}),ke=()=>{L.value?(R.value.articleId=y.value,R.value.content=L.value,L.value="",Oe(R.value).then(p=>{M()})):I({type:"warning",message:"评论不能为空"})},ne=(p,g)=>{i.value?(N.value.toId=u.value,N.value.content=i.value,N.value.commentId=x.value,N.value.articleId=y.value,je(N.value).then($=>{M()}),i.value="",s.value=null,U.value=null):I({type:"warning",message:"回复不能为空"})},M=()=>{He(y.value).then(p=>{S.value=p.data})};return M(),$e(()=>w.state.user.avatar,p=>{v.value=p,c.value=w.state.user.name},{immediate:!0}),(p,g)=>{const $=de,q=Le,O=_e,j=J("Comment"),P=ge,re=J("DeleteFilled");return h(),f("div",null,[e("div",_t,[t($,{class:"header-img",size:40,src:v.value},null,8,["src"]),e("div",vt,[t(q,{class:"reply-input",modelValue:L.value,"onUpdate:modelValue":g[0]||(g[0]=T=>L.value=T),rows:2,type:"textarea","show-word-limit":"",maxlength:"200",placeholder:"输入评论...",onFocus:l},null,8,["modelValue"])]),te(e("div",pt,[t(O,{class:"reply-btn",size:"default",onClick:ke,type:"primary"},{default:d(()=>[m("发表评论")]),_:1})],512),[[le,o.value&&H(C)]])]),(h(!0),f(Z,null,G(S.value,(T,F)=>(h(),f("div",{key:F,class:"author-title reply-father"},[t($,{size:40,src:`/dev-api${T.avatar}`},null,8,["src"]),e("div",mt,[e("span",ht,_(T.userName),1),e("span",ft,_(H(ie)(T.createTime)),1)]),e("div",yt,[e("span",{onClick:k=>A(F,T.userName,T.userId,T.commentId)},[t(P,null,{default:d(()=>[t(j)]),_:1}),m("回复 ")],8,gt),T.userName===c.value?(h(),f("span",{key:0,onClick:k=>r(T.commentId),style:{"font-size":"15px",color:"red"}},[t(P,null,{default:d(()=>[t(re)]),_:1}),m("删除")],8,kt)):se("",!0)]),e("div",wt,[e("p",null,[e("span",Ct,_(T.content),1)])]),te(e("div",It,[t($,{class:"header-img",size:40,src:v.value},null,8,["src"]),e("div",bt,[t(q,{class:"reply-input reply-comment-input",modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=k=>i.value=k),rows:2,"show-word-limit":"",maxlength:"200",type:"textarea",placeholder:a.value,onFocus:l},null,8,["modelValue","placeholder"])]),e("div",xt,[t(O,{class:"reply-btn",size:"default",onClick:k=>ne(F,p.j),type:"primary"},{default:d(()=>[m("发表评论")]),_:2},1032,["onClick"])])],512),[[le,V(F)]]),e("div",$t,[(h(!0),f(Z,null,G(T.commentsLevel,(k,X)=>(h(),f("div",{key:X,class:"author-title"},[t($,{size:40,src:`/dev-api${k.avatar}`},null,8,["src"]),e("div",Lt,[e("span",Nt,_(k.createBy),1),e("span",Tt,_(H(ie)(k.createTime)),1)]),e("div",St,[e("span",{onClick:Y=>W(F,X,k.createBy,k.replyId,k.commentId)},[t(P,null,{default:d(()=>[t(j)]),_:1}),m("回复 ")],8,Vt),k.createBy===c.value?(h(),f("span",{key:0,onClick:Y=>B(k.id,k.toId),style:{"font-size":"15px",color:"red"}},[t(P,null,{default:d(()=>[t(re)]),_:1}),m("删除")],8,Et)):se("",!0)]),e("div",Ut,[e("p",null,[e("span",null,"回复 "+_(k.toName)+":",1),e("span",zt,_(k.content),1)])]),te(e("div",Rt,[t($,{class:"header-img",size:40,src:v.value},null,8,["src"]),e("div",Bt,[t(q,{class:"reply-input reply-comment-input",modelValue:i.value,"onUpdate:modelValue":g[2]||(g[2]=Y=>i.value=Y),rows:2,"show-word-limit":"",maxlength:"200",type:"textarea",placeholder:a.value,onFocus:l},null,8,["modelValue","placeholder"])]),e("div",Dt,[t(O,{class:"reply-btn",size:"default",onClick:Y=>ne(),type:"primary"},{default:d(()=>[m("发表评论")]),_:2},1032,["onClick"])])],512),[[le,D(F,X)]])]))),128))])]))),128))])}}},qt=Q(At,[["__scopeId","data-v-429c6d28"]]);const K=b=>(he("data-v-b5f94ee8"),b=b(),fe(),b),Ft={class:"post-container",style:{position:"relative"}},Mt={class:"left-card"},Ot={class:"post-title"},jt={class:"post-info"},Ht={class:"post-abstract"},Jt={class:"tag-list"},Kt=K(()=>e("img",{src:Ke,alt:"Tag Icon",class:"tag-icon"},null,-1)),Pt=K(()=>e("hr",null,null,-1)),Yt={class:"like-collection"},Zt={class:"el-like"},Gt={key:0,src:Pe,alt:"Like Icon",class:"svg-like"},Qt={key:1,src:Ye,alt:"Like Icon",class:"svg-like"},Wt={class:"el-like"},Xt=K(()=>e("span",null," 评论",-1)),el={class:"el-like"},tl={key:0,src:Ze,alt:"Collection Icon",class:"svg-like"},ll={key:1,src:Ge,alt:"Collection Icon",class:"svg-like"},sl=K(()=>e("div",{class:"comment-num"},[e("p",null,"评论")],-1)),al=K(()=>e("hr",null,null,-1)),ol={class:"right-card"},nl={__name:"index",setup(b){var N;const E=n(null);ue();const y=oe(),w=ye(),o=n(""),i=n((N=w.params)==null?void 0:N.id),a=n(!1),c=n({like:0,collection:0}),v=n({like_status:!1,collection_status:!1}),C=async l=>{await Ue(l).then(s=>{o.value=s.data})},z=()=>{y?i.value&&Be({articleId:i.value}).then(l=>{c.value.collection=l.data.collection,v.value.collection_status=l.data.status}):I({message:"请先登录",type:"error"})},u=()=>{y?i.value&&De({articleId:i.value}).then(l=>{c.value.like=l.data.like_num,v.value.like_status=l.data.status}):I({message:"请先登录",type:"error"})},x=()=>{y?Re({articleId:i.value}).then(l=>{c.value.collection=l.data.collection.collection_num,c.value.like=l.data.like.like_num,v.value.collection_status=l.data.collection.status,v.value.like_status=l.data.like.status}):ze(i.value).then(l=>{c.value.collection=l.data.collection,c.value.like=l.data.like})},S=()=>{const l=window.pageYOffset||document.documentElement.scrollTop;a.value=l>=220};pe(()=>{window.addEventListener("scroll",S),C(i.value),x()});const L=l=>Ne(l);return(l,s)=>{const r=J("Calendar"),B=ge,V=J("View"),D=Te,U=J("Comment"),A=ve,W=Se;return h(),f("div",Ft,[e("div",Mt,[t(A,{class:"post-card"},{default:d(()=>[e("h1",Ot,_(o.value.title),1),e("div",jt,[e("span",null,_(o.value.userName),1),e("span",null,[t(B,null,{default:d(()=>[t(r)]),_:1}),m(" "+_(L(o.value.createTime,"{y}-{m}-{d} {h}:{i}:{s}")),1)]),e("span",null,[t(B,{size:"16px"},{default:d(()=>[t(V)]),_:1}),m(_(o.value.viewCount>1e3?Math.floor(o.value.viewCount/1e3)+"K":o.value.viewCount),1)])]),e("div",Ht,_(o.value.abstracts),1),t(H(Je),{id:"content",ref_key:"articleContent",ref:E,class:"article-content",modelValue:o.value.content,"onUpdate:modelValue":s[0]||(s[0]=R=>o.value.content=R),previewOnly:""},null,8,["modelValue"]),e("div",Jt,[(h(!0),f(Z,null,G(o.value.articleTags,R=>(h(),f("span",{key:R.id,class:"tag-item"},[Kt,m(" "+_(R.name),1)]))),128))]),Pt,e("div",Yt,[e("div",Zt,[t(D,{onClick:u,class:"item"},{default:d(()=>[v.value.like_status?(h(),f("img",Gt)):(h(),f("img",Qt)),e("span",{style:ae({color:v.value.like_status?"dodgerblue":"black"})}," 点赞("+_(c.value.like>99?99:c.value.like)+")",5)]),_:1})]),e("div",Wt,[t(B,null,{default:d(()=>[t(U)]),_:1}),Xt]),e("div",el,[t(D,{onClick:z,class:"item"},{default:d(()=>[v.value.collection_status?(h(),f("img",tl)):(h(),f("img",ll)),e("span",{style:ae({color:v.value.collection_status?"dodgerblue":"black"})},"  收藏("+_(c.value.collection)+") ",5)]),_:1})])])]),_:1}),t(A,{class:"comments-card"},{default:d(()=>[sl,al,t(qt)]),_:1})]),e("div",ol,[t(tt),e("div",{class:me({fixed:a.value})},[t(dt)],2)]),t(W,{right:100,bottom:100})])}}},hl=Q(nl,[["__scopeId","data-v-b5f94ee8"]]);export{hl as default};
