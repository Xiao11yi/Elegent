import{a1 as E,_ as Y,u as H,z as Q,r as i,o as Z,a as D,b as c,k as y,w as o,g as ee,d as g,f as a,h as _,i as h,c as x,e as R,F as j,K as d,l as ae,E as le,X as te,$ as oe,a4 as re,a5 as se,M as ne,N as ue,Y as ie,W as de,m as k,v as ce,x as me}from"./index-08731fde.js";/* empty css                *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                    */import{J as pe}from"./style-a54575cc.js";import{c as fe,b as _e,m as ge,n as ve}from"./article-969d75ae.js";function be(s){return E({url:"/common/upLoad/image",method:"post",data:s,headers:{"Content-Type":"multipart/form-data"}})}function ye(s){return E({url:"/manage/article/write",method:"post",data:s,headers:{repeatSubmit:!1}})}function he(s){return E({url:"common/upload/articleImg",method:"post",data:s,headers:{"Content-Type":"multipart/form-data"}})}const we=s=>(ce("data-v-76b34281"),s=s(),me(),s),Ve={class:""},Ie={class:"my-header flex justify-between"},xe=we(()=>g("h4",{class:"font-bold"},"写文章",-1)),ke=["src"],Ee={class:"dialog-footer"},Pe={__name:"index",setup(s){var q,F;H();const P=Q(),w=i(!0),v=i(!1),l=i({title:"",content:"",mainPic:"",categoryId:null,articleTags:[],abstracts:"",isSticky:"0",viewCount:0}),b=i(null),S=()=>{v.value=!1,b.value.clearValidate(),b.value.resetFields()},z={title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:40,message:"文章标题要求大于1个字符，小于100个字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}],mainPic:[{required:!0,message:"请上传文章封面",trigger:"blur"}],categoryId:[{required:!0,message:"请选择文章分类",trigger:"blur"}],blogArticleTags:[{required:!0,message:"请选择文章标签",trigger:"blur"}],abstracts:[{required:!0,message:"请输入文章摘要",trigger:"blur"}]},M=r=>{if(U(r.raw)){let e=new FormData;e.append("file",r.raw),e.append("imageUpLoad",l.value.mainPic),be(e).then(n=>{n.code==200&&(l.value.mainPic=n.data.fileName,d({message:"上传成功",type:"success"}))})}},U=r=>{const e=["jpeg","jpg","gif","png"],n=r.type.split("/")[1],f=r.size/1024/1024;return e.indexOf(n)===-1?(d.error("图片必须是JPG/png/gif/jpeg格式!"),!1):f>2?(d.error("图片不能超过2MB!"),!1):!0},N=async(r,e)=>{await Promise.all(r.map(n=>new Promise((f,V)=>{if(U(n)){let u=new FormData;u.append("file",n),he(u).then(I=>{e([I.data.url])})}})))},O=()=>{w.value=!0,b.value.validate(r=>{if(r)l.value.content===""?d({message:"内容不能为空",type:"error"}):m.value!=null&&m.value!=null&&p.value!=null&&p.value!=null?(l.value.id=m.value,ve(l.value).then(e=>{if(e.code!==200){d({message:"修改失败",type:"error"});return}d({message:"修改成功",type:"success"}),w.value=!1,setInterval(()=>{window.opener=null,window.close()},600)})):ye(l.value).then(e=>{if(e.code!==200){d({message:"发布失败",type:"error"});return}d({message:"发布成功",type:"success"}),w.value=!1,location.reload()});else return!1})},C=i([]);fe().then(r=>{C.value=r.rows});const G=i(!1),T=i([]);_e().then(r=>{T.value=r.rows});const m=i((q=P.query)==null?void 0:q.id),p=i((F=P.query)==null?void 0:F.isSticky);return Z(()=>{m.value!=null&&m.value!=null&&p.value!=null&&p.value!=null&&ge(m.value,p.value).then(r=>{l.value=r.data})}),(r,e)=>{const n=D("Promotion"),f=ae,V=le,u=te,I=D("Plus"),J=oe,A=re,L=se,B=ne,W=ue,$=ie,K=de,X=ee;return c(),y(X,null,{header:o(()=>[g("div",Ve,[g("div",Ie,[xe,g("div",null,[a(h(k),{type:"primary",onClick:e[0]||(e[0]=t=>v.value=!0)},{default:o(()=>[a(f,{class:"mr-1"},{default:o(()=>[a(n)]),_:1}),_(" 发布 ")]),_:1})])])])]),default:o(()=>[a(h(pe),{toolbarsExclude:["github"],modelValue:l.value.content,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.content=t),onOnUploadImg:N,editorId:"publishArticleEditor"},null,8,["modelValue"]),a(K,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value=t),title:"文章信息",width:"600",onClose:S},{footer:o(()=>[g("div",Ee,[a(h(k),{onClick:S},{default:o(()=>[_("取消")]),_:1}),a(h(k),{type:"primary",onClick:O},{default:o(()=>[_(" 提交 ")]),_:1})])]),default:o(()=>[a($,{model:l.value,ref_key:"publishArticleFormRef",ref:b,"label-position":"top",rules:z},{default:o(()=>[a(u,{label:"标题",prop:"title"},{default:o(()=>[a(V,{modelValue:l.value.title,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.title=t),autocomplete:"off",size:"large",maxlength:"100","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1}),a(u,{label:"封面",prop:"mainPic"},{default:o(()=>[a(J,{class:"avatar-uploader",action:"#","on-change":M,"auto-upload":!1,"show-file-list":!1},{default:o(()=>[l.value.mainPic?(c(),x("img",{key:0,src:"/dev-api"+l.value.mainPic,class:"avatar",title:"封面"},null,8,ke)):(c(),y(f,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[a(I)]),_:1}))]),_:1})]),_:1}),a(u,{label:"摘要",prop:"abstracts"},{default:o(()=>[a(V,{modelValue:l.value.abstracts,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.abstracts=t),rows:3,"show-word-limit":"",maxlength:"100",type:"textarea",placeholder:"请输入文章摘要"},null,8,["modelValue"])]),_:1}),a(u,{label:"分类",prop:"categoryId",style:{width:"240px"}},{default:o(()=>[a(L,{modelValue:l.value.categoryId,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.categoryId=t),clearable:"",placeholder:"---请选择---"},{default:o(()=>[(c(!0),x(j,null,R(C.value,t=>(c(),y(A,{key:t.id,label:t.category,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"标签",prop:"articleTags"},{default:o(()=>[a(L,{modelValue:l.value.articleTags,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.articleTags=t),multiple:"",filterable:"",placeholder:"---请选择---","value-key":"id","default-first-option":"",loading:G.value,"multiple-limit":3,size:"large"},{default:o(()=>[(c(!0),x(j,null,R(T.value,t=>(c(),y(A,{key:t.id,label:t.name,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(u,{label:"状态",prop:"isSticky"},{default:o(()=>[a(W,{modelValue:l.value.isSticky,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.isSticky=t)},{default:o(()=>[a(B,{value:"0"},{default:o(()=>[_("草稿")]),_:1}),a(B,{value:"1"},{default:o(()=>[_("公开")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},je=Y(Pe,[["__scopeId","data-v-76b34281"]]);export{je as default};
