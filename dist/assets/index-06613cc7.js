import{_ as B,y as E,r as x,z as D,u as q,B as m,C as F,o as z,a2 as J,b as r,c,d as n,t as _,f as u,w as T,F as b,aa as R,T as U,E as A,m as H,e as L,i as O,J as P,h as W,S as j,V as G}from"./index-08731fde.js";/* empty css                 */import{a as K,b as Q}from"./chat-4cb3b98c.js";const X={class:"chat-name"},Y={class:"chat-list"},Z={key:0,class:"timestamp"},$={key:1,class:"message-left"},ee={class:"message-content reply-content"},te={key:2,class:"message-right"},ae={class:"message-content"},se={class:"chat-content"},oe={__name:"index",setup(ne){const C=E(),l=x(""),f=x([]),p=D();q();const i=m(()=>{const e=p.query.id;return!isNaN(parseFloat(e))&&isFinite(e)?parseInt(e,10):""}),N=m(()=>p.query.chatName),y=m(()=>p.query.toId),v=async e=>{try{if(i.value!=""||e!=""){const t=await K(i.value===""?e:i.value);f.value=t.data,await new Promise(s=>setTimeout(s,0)),M()}}catch{}},o=m(()=>C.state.webscoket.message),S=async()=>{try{o.value.message!=null&&o.value.message!=999&&!isNaN(o.value.message)&&o.value.message.trim()!==""&&o.value.message==i.value&&await v(o.value.message)}catch{}};F(o,(e,t)=>{S()},{deep:!0}),z(()=>{v(i.value)});const I=async()=>{if(l.value.trim()==="")return;const e={toId:y.value,chatMessage:{content:l.value,type:1}},t=JSON.parse(localStorage.getItem("newChat"));t!=null&&e.toId==t.to_id&&localStorage.removeItem("newChat");try{const s=await Q(e);l.value="",v(Number(s.data))}catch{}},M=()=>{R(()=>{const e=document.querySelector(".el-scrollbar__wrap");e&&(e.scrollTop=e.scrollHeight)})};J(()=>{});let h="";function V(e,t){if(t===0)return h=e,!0;const s=new Date(h).getTime(),g=new Date(e).getTime(),d=Math.abs((g-s)/1e3)<60*15;return d||(h=e),!d}return(e,t)=>{const s=j,g=U,w=A,d=H;return r(),c(b,null,[n("p",X,_(N.value),1),n("div",Y,[u(g,{style:{width:"100%"},ref:"myScrollbar"},{default:T(()=>[(r(!0),c(b,null,L(f.value,(a,k)=>(r(),c("div",{key:a.id,class:"scrollbar-demo-item"},[V(a.create_time,k)?(r(),c("div",Z,_(O(G)(a.create_time)),1)):P("",!0),a.sender==y.value?(r(),c("div",$,[u(s,{size:40,src:"/dev-api"+a.avatar},null,8,["src"]),n("div",ee,[n("p",null,_(a.content),1)])])):(r(),c("div",te,[n("div",ae,[n("p",null,_(a.content),1)]),u(s,{size:40,src:"/dev-api"+a.avatar},null,8,["src"])]))]))),128))]),_:1},512)]),n("div",se,[u(w,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a),rows:3,placeholder:"Type a message","show-word-limit":"",maxlength:"200",type:"textarea"},null,8,["modelValue"]),u(d,{onClick:I,type:"primary",class:"btn-sender"},{default:T(()=>[W("发送")]),_:1})])],64)}}},ie=B(oe,[["__scopeId","data-v-212636a8"]]);export{ie as default};
